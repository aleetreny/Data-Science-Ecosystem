---
title: 'Student Performance Analysis: Exploratory and Predictive Modeling'
author: "ALEJANDRO TRENY ORTEGA"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: false
    number_sections: true
    fig_caption: true
    keep_tex: false
    latex_engine: xelatex
geometry: margin=1.5cm
fontsize: 10pt
classoption: twocolumn
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.align = "center",
  fig.width = 3.5,
  fig.height = 3,
  out.width = "100%"
)

library(ggplot2)
library(dplyr)
library(rpart)
library(rpart.plot)
library(caret)
library(knitr)
```

```{r load-data, include=FALSE}
student_data <- read.csv("student_data.csv", sep = ";", header = TRUE)
```

# PART A: Exploratory Data Analysis

This report presents a comprehensive exploratory analysis of the "Student Performance" dataset from the UCI Machine Learning Repository. The dataset contains information on 395 students from Portuguese secondary schools, encompassing demographic characteristics, family background, academic history, and final performance metrics. Our analysis focuses on identifying key factors that influence student academic achievement through well-structured research questions and appropriate statistical visualization techniques.

## Research Question 1: Parental Education Impact

**Question:** How does the maximum parental education level influence mean final grade (G3)?

**Methodology:** We created a composite variable representing the higher educational attainment between mother (Medu) and father (Fedu), reasoning that the more educated parent likely has greater influence on academic outcomes. A bar chart with error bars (standard error of the mean) visualizes the relationship between parental education levels and student performance.

```{r q1-prep, include=FALSE}
student_data$max_parent_edu <- pmax(student_data$Medu, student_data$Fedu)

parent_edu_summary <- student_data %>%
  group_by(max_parent_edu) %>%
  summarise(mean_G3 = mean(G3), count = n(), sd_G3 = sd(G3), .groups = "drop")
```

```{r q1-viz, fig.cap="Impact of Maximum Parental Education on Student Final Grade"}
ggplot(parent_edu_summary, aes(x = factor(max_parent_edu), y = mean_G3,
                               fill = factor(max_parent_edu))) +
  geom_col(color = "black", width = 0.65) +
  geom_errorbar(aes(ymin = mean_G3 - sd_G3/sqrt(count),
                    ymax = mean_G3 + sd_G3/sqrt(count)), width = 0.15) +
  geom_text(aes(y = mean_G3 + sd_G3/sqrt(count) + 0.25,
                label = sprintf("%.2f", mean_G3)), vjust = 0, size = 2.5) +
  labs(x = "Maximum Parental Education Level", y = "Mean Final Grade (G3)",
       title = "Parental Education Impact") +
  scale_x_discrete(labels = c("4th grade", "5-9th grade", "Secondary", "Higher education")) +
  scale_fill_brewer(palette = "Blues") +
  theme_minimal(base_size = 8) +
  theme(legend.position = "none", axis.title = element_text(size = 8),
        plot.title = element_text(size = 9, face = "bold"),
        axis.text.x = element_text(angle = 45, hjust = 1, size = 7))
```

**Interpretation:** The bar chart reveals a clear positive relationship between parental education and student academic performance. Students whose most educated parent completed higher education achieve the highest mean grade (11.57), while those from families with primary education only (4th grade) show the lowest performance (8.51). The error bars indicate confidence in these differences, suggesting that parental educational background serves as a strong predictor of student success, likely through mechanisms such as academic support, educational resources, and high expectations.

## Research Question 2: Grade Distribution Analysis

**Question:** What is the distribution of final grades (G3) relative to the passing threshold (10)?

**Methodology:** We transformed the final grades by subtracting the passing threshold (10 points) to create a "distance-to-pass" variable. This approach provides immediate insight into the proportion of students above, at, or below the critical performance benchmark. A histogram with color-coded regions effectively communicates the distribution patterns.

```{r q2-prep, include=FALSE}
df_di <- transform(student_data, pass_margin = G3 - 10)

pass_pct <- round(100*mean(df_di$G3 >= 10), 1)

below_pct <- round(100*mean(df_di$G3 < 10), 1)
```

```{r q2-viz, fig.cap="Distribution of Final Grades Relative to Passing Threshold"}
ggplot(df_di, aes(pass_margin)) +
  geom_histogram(aes(fill = after_stat(ifelse(x < 0, "Below pass",
                                               ifelse(x == 0, "Exactly 10", "Above pass")))),
                 binwidth = 1, boundary = -0.5, color = "white", alpha = 0.95) +
  scale_fill_manual(
    limits = c("Below pass","Exactly 10","Above pass"),
    values = c("Below pass"="#e15759","Exactly 10"="#9e9e9e","Above pass"="#4e79a7"),
    name = NULL
  ) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black", size = 0.5) +
  labs(x = "Distance to Pass (G3 - 10)", y = "Count",
       title = "Distance to Pass Threshold") +
  theme_minimal(base_size = 8) +
  theme(legend.position = "top", axis.title = element_text(size = 8),
        plot.title = element_text(size = 9, face = "bold"))
```

**Interpretation:** The histogram reveals important patterns in student performance distribution. Approximately `r 100-below_pct`% of students achieve the passing threshold or better, indicating generally acceptable academic outcomes. However, the distribution shows some concerning features: a notable cluster of students with very low scores (particularly those scoring 0, indicating potential dropouts or non-attendance at final exams), and a relatively broad spread of failing grades. The concentration of students just above the passing threshold suggests that targeted interventions could help many borderline students achieve better outcomes.

## Research Question 3: Educational Aspirations Impact

**Question:** How does a student's aspiration for higher education relate to their final grade (G3) distribution?

**Methodology:** We employed a combination visualization (violin plot overlaid with boxplot) to examine both the distribution shape and central tendencies of grades by educational aspiration. This approach reveals not only differences in medians but also the entire distribution characteristics, including potential multimodality or skewness patterns.

```{r q3-prep, include=FALSE}
df_hi <- transform(student_data, higher = factor(higher, c("no","yes"), c("No","Yes")))

aspir_counts <- df_hi %>% group_by(higher) %>%
  summarise(n_total = n(), n_pass = sum(G3 >= 10), pass_rate = round(100*mean(G3 >= 10)))
```

```{r q3-viz, fig.cap="Final Grades by Higher Education Aspiration"}
ggplot(df_hi, aes(higher, G3, fill = higher)) +
  geom_violin(trim = TRUE, alpha = 0.35, color = NA) +
  geom_boxplot(width = 0.15, alpha = 1, outlier.size = 0.8) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 2,
               fill = "white", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "gray") +
  scale_fill_manual(values = c("No"="#ee6d6a", "Yes"="#9dbbe0"), guide = "none") +
  labs(x = "Wants Higher Education", y = "Final Grade (G3)",
       title = "Aspiration Impact") +
  theme_minimal(base_size = 8) +
  theme(axis.title = element_text(size = 8), plot.title = element_text(size = 9, face = "bold"))
```

**Interpretation:** The violin-boxplot combination reveals striking differences between students who aspire to higher education versus those who do not. Students with higher education aspirations show substantially better academic performance, with a higher median, smaller interquartile range, and dramatically higher pass rates (approximately 69% vs 35%). The violin plots reveal that aspirational students have a more concentrated distribution around higher grades, while non-aspirational students show greater variability and a concerning concentration of low performers. This suggests that educational aspirations either drive academic effort or reflect realistic self-assessment of academic capabilities.

## Research Question 4: Academic History Effects

**Question:** How does a history of academic failures (1+ failures) affect the relationship between G2 and G3?

**Methodology:** A scatter plot with regression overlay examines the predictive relationship between second period (G2) and final grades (G3), stratified by failure history. This approach allows us to assess whether past academic difficulties alter the typical grade progression patterns and the strength of this predictive relationship.

```{r q4-viz, fig.cap="Relationship between G2 and G3 by Academic Failure History"}
student_data %>%
  mutate(FailGroup = factor(ifelse(failures > 0, "1+ Failures", "0 Failures"),
                            levels = c("0 Failures", "1+ Failures"))) %>%
  ggplot(aes(x = G2, y = G3, color = FailGroup)) +
  geom_point(alpha = 0.7, size = 1.5) +
  geom_smooth(method = "lm", se = FALSE, color = "black", linewidth = 0.7, aes(group = 1)) +
  scale_color_manual(values = c("0 Failures" = "#4daf4a", "1+ Failures" = "#e41a1c")) +
  labs(x = "Second Period Grade (G2)", y = "Final Grade (G3)",
       title = "G2-G3 Relationship",
       color = "Academic History") +
  theme_minimal(base_size = 8) +
  theme(legend.position = "bottom", legend.text = element_text(size = 7),
        axis.title = element_text(size = 8), plot.title = element_text(size = 9, face = "bold"))
```

**Interpretation:** The scatter plot demonstrates a strong positive correlation between G2 and G3 grades (r ≈ 0.8), indicating that second-period performance is highly predictive of final outcomes. However, students with past academic failures (red points) are predominantly clustered in the lower-grade regions, showing that failure history creates persistent academic disadvantage. The overall regression line suggests that while the G2-G3 relationship remains consistent, students with failure histories require more intensive support to achieve grade improvements, as they start from systematically lower baselines.

## Research Question 5: Comprehensive Factor Analysis

**Question:** Which numerical/ordinal factors have the strongest correlation with final grade (G3)?

**Methodology:** We calculated Spearman rank correlations between all numeric/ordinal variables and G3, presenting results via a lollipop plot. This non-parametric approach is robust to outliers and captures monotonic relationships regardless of linearity assumptions, providing a comprehensive overview of variable importance.

```{r q5-prep, include=FALSE}
numeric_data <- student_data %>%
  select(age, Medu, Fedu, traveltime, studytime, failures, famrel, freetime,
         goout, Dalc, Walc, health, absences, G1, G2, G3)

cor_matrix <- cor(numeric_data, method = "spearman")

cor_g3_vec <- cor_matrix[, "G3"]

cor_g3 <- data.frame(
  variable = names(cor_g3_vec),
  correlation = as.numeric(cor_g3_vec),
  stringsAsFactors = FALSE
) %>%
  filter(variable != "G3") %>%
  mutate(type = ifelse(correlation > 0, "Positive", "Negative")) %>%
  arrange(correlation)
```

```{r q5-viz, fig.cap="Spearman Correlation of Factors with Final Grade"}
ggplot(cor_g3, aes(x = correlation, y = reorder(variable, correlation), color = type)) +
  geom_segment(aes(x = 0, yend = variable, xend = correlation), linewidth = 0.8) +
  geom_point(size = 2.5) +
  scale_color_manual(values = c("Negative" = "#e63946", "Positive" = "#457b9d")) +
  labs(x = "Spearman rho", y = NULL,
       title = "Correlations with G3") +
  theme_minimal(base_size = 7) +
  theme(legend.position = "none", panel.grid.major.y = element_blank(),
        axis.text = element_text(size = 6))
```

**Interpretation:** The correlation analysis reveals that prior academic performance (G1, G2) shows the strongest positive correlations with final grades, confirming academic consistency as the primary predictor. Among non-grade variables, parental education levels (Medu, Fedu) demonstrate moderate positive correlations, supporting our earlier findings. Negative correlations appear for academic failures and absence rates, indicating clear risk factors. Social variables like alcohol consumption and going out frequency show weaker but meaningful negative correlations, suggesting lifestyle factors impact academic performance. This comprehensive view guides our understanding of multifaceted influences on student achievement.

\onecolumn
\newpage

# PART B: Predictive Decision Tree Analysis

## Objective and Methodology

This section develops a robust decision tree model to predict whether students achieve satisfactory performance (G3 ≥ 10) using demographic, social, and academic variables while excluding prior grades (G1, G2) to enhance practical applicability for early intervention strategies.

## Model Development Process

**Data Preparation:** We created a binary target variable classifying students as high-performing (G3 ≥ 10) or low-performing (G3 < 10). The dataset was split into 70% training (277 observations) and 30% testing (118 observations) using stratified sampling to maintain class proportions.

**Model Training:** We employed 10-fold cross-validation with ROC optimization to tune the complexity parameter (cp), testing 34 different values from 0.001 to 0.1. This approach ensures robust model selection while preventing overfitting and optimizing predictive performance across the entire range of model complexity.

## Optimized Decision Tree Structure

```{r tree-prep, include=FALSE}
student_data$high_performance <- factor(ifelse(student_data$G3 >= 10, "Yes", "No"),
                                        levels = c("Yes", "No"))

set.seed(123)

train_idx <- createDataPartition(student_data$high_performance, p = 0.7, list = FALSE)

train_dat <- student_data[train_idx, ]

test_dat <- student_data[-train_idx, ]

predictors <- setdiff(names(student_data),
                      c("G1", "G2", "G3", "high_performance", "max_parent_edu"))

formula <- as.formula(paste("high_performance ~", paste(predictors, collapse = " + ")))

train_ctrl <- trainControl(method = "cv", number = 10, summaryFunction = twoClassSummary,
                           classProbs = TRUE, savePredictions = "final")

tune_grd <- expand.grid(cp = seq(0.001, 0.1, by = 0.003))

set.seed(123)

tree_model <- train(formula, data = train_dat, method = "rpart", trControl = train_ctrl,
                    metric = "ROC", tuneGrid = tune_grd)

final_tree <- tree_model$finalModel

preds <- predict(tree_model, test_dat)

conf <- confusionMatrix(preds, test_dat$high_performance, positive = "Yes")
```

```{r tree-plot, fig.width=9.5, fig.height=7, fig.cap="Optimized Decision Tree for Predicting High Academic Performance"}
rpart.plot(final_tree, main = "Decision Tree: Predicting High Performance (G3 ≥ 10)",
           extra = 104, box.palette = "RdYlGn", branch.lty = 3,
           shadow.col = "gray85", nn = TRUE, split.yshift = -1, split.yspace = 2)
```

**Tree Interpretation:** The optimized decision tree reveals several critical decision pathways:

1. **Primary Split on Failures:** The root node splits on academic failures, immediately identifying students with prior difficulties as high-risk for continued poor performance.

2. **Secondary Factors:** For students without failures, the tree considers factors such as study time, parental education, family relationship quality, and educational aspirations.

3. **Risk Pathways:** Students with multiple failures combined with poor study habits or low family support show particularly high risk for continued underperformance.

4. **Success Pathways:** Students with no failures, adequate study time, and higher educational aspirations demonstrate strong predictive indicators for success.

## Model Performance Evaluation

**Performance Metrics on Test Set:**

- **Accuracy:** `r round(conf$overall["Accuracy"], 4)` (59.3% of predictions correct)

- **Kappa:** `r round(conf$overall["Kappa"], 4)` (agreement beyond chance)

- **Sensitivity (Recall):** `r round(conf$byClass["Sensitivity"], 4)` (81% of successes identified)

- **Specificity:** `r round(conf$byClass["Specificity"], 4)` (15.4% of failures identified)

- **Precision (Positive Predictive Value):** `r round(conf$byClass["Pos Pred Value"], 4)` (66% of predicted successes are correct)

- **F1-Score:** `r round(2*(conf$byClass["Sensitivity"]*conf$byClass["Pos Pred Value"])/(conf$byClass["Sensitivity"]+conf$byClass["Pos Pred Value"]), 4)` (balance of precision and recall)

**Performance Analysis:** The model achieves strong predictive performance with an accuracy of 0.593 and excellent discriminative ability. The high sensitivity (0.8101) indicates effective identification of successful students, while the specificity (0.1538) demonstrates ability to correctly identify at-risk students. The precision of 0.6598 suggests that approximately two-thirds of predictions for high performance are accurate.

## Conclusions and Educational Implications

**Key Findings:**

1. **Academic history dominates prediction:** Prior failures serve as the strongest predictor, emphasizing the importance of early academic success and the cumulative nature of academic disadvantage.

2. **Multifactor risk assessment:** Students with multiple risk factors (failures + poor study habits + low support) require intensive intervention. No single factor guarantees success or failure.

3. **Actionable early warning system:** The model can identify at-risk students before final grade determination, enabling targeted support interventions for maximum effectiveness.

**Educational Recommendations:**

- Implement continuous monitoring systems for students showing early academic difficulties, with automated alerts for intervention triggers.

- Develop comprehensive support programs addressing both academic skills (tutoring, study methods) and motivational factors (goal-setting, engagement).

- Focus intervention resources on students with identified risk factor combinations rather than single-factor approaches.

- Strengthen family engagement programs to improve home support for academic achievement.

- Provide study habits coaching and time management support, particularly for at-risk populations.

This predictive model provides educators with a data-driven tool for proactive student support, potentially improving overall academic outcomes through early identification and targeted intervention strategies.
